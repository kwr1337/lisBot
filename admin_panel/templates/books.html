{% extends "base.html" %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–∏–≥–∞–º–∏ - Library Admin{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- –°–≤–æ–¥–∫–∞ -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body text-center">
                    <h5 class="card-title text-primary mb-3">
                        <span class="fs-2">üìö</span><br>
                        –í—Å–µ–≥–æ –∫–Ω–∏–≥
                    </h5>
                    <p class="card-text display-6 mb-0">{{ total_books }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body text-center">
                    <h5 class="card-title text-success mb-3">
                        <span class="fs-2">üìñ</span><br>
                        –í—Å–µ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤
                    </h5>
                    <p class="card-text display-6 mb-0">{{ total_copies }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body text-center">
                    <h5 class="card-title text-warning mb-3">
                        <span class="fs-2">üìò</span><br>
                        –í—ã–¥–∞–Ω–æ
                    </h5>
                    <p class="card-text display-6 mb-0">{{ borrowed_copies }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–æ–∏—Å–∫ -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-8">
                    <div class="input-group">
                        <span class="input-group-text bg-primary text-white">
                            <i class="fas fa-search">üîç</i>
                        </span>
                        <input type="text" 
                               class="form-control border-primary" 
                               id="searchInput" 
                               placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∞–≤—Ç–æ—Ä—É..."
                               value="{{ search_query }}">
                    </div>
                </div>
                <div class="col-md-4 text-end">
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#bookModal">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É
                        </button>
                        <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown">
                            <span class="visually-hidden">Toggle Dropdown</span>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/admin/books/template/download">üì• –°–∫–∞—á–∞—Ç—å —à–∞–±–ª–æ–Ω Excel</a></li>
                            <li><a class="dropdown-item" href="#" onclick="document.getElementById('excelUpload').click()">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ Excel</a></li>
                        </ul>
                    </div>
                    <input type="file" id="excelUpload" style="display: none" accept=".xlsx" onchange="uploadExcel(this)">
                </div>
            </div>
        </div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –∫–Ω–∏–≥ -->
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏</th>
                    <th>–ê–≤—Ç–æ—Ä</th>
                    <th>–¢–µ–º–∞—Ç–∏–∫–∞(–ñ–∞–Ω—Ä)</th>
                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                    <th>–ö–æ–ª-–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü</th>
                    <th>–ù–æ–º–µ—Ä –∏–∑–¥–∞–Ω–∏—è</th>
                    <th>–ì–æ–¥ –∏–∑–¥–∞–Ω–∏—è</th>
                    <th>–ò–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ</th>
                    <th>–î–æ—Å—Ç—É–ø–Ω–æ/–í—Å–µ–≥–æ</th>
                    <th>–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for book in books %}
                <tr>
                    <td>{{ book.title }}</td>
                    <td>{{ book.author }}</td>
                    <td>{{ book.theme or '‚Äî' }}</td>
                    <td>{{ book.description }}</td>
                    <td>{{ book.pages }}</td>
                    <td>{{ book.edition_number or '‚Äî' }}</td>
                    <td>{{ book.publication_year }}</td>
                    <td>{{ book.publisher }}</td>
                    <td>{{ book.available_copies }}/{{ book.total_copies }}</td>
                    <td>
                        {% if book.avg_price > 0 %}
                            {{ book.avg_price }} ‚ÇΩ
                        {% else %}
                            <span class="text-muted">‚Äî</span>
                        {% endif %}
                    </td>
                    <td>
                        <button class="btn btn-sm btn-primary" 
                                onclick='editBook({{ book.id }}, {{ book.title|tojson }}, {{ book.author|tojson }}, 
                                        {{ book.description|tojson }}, {{ book.theme|tojson if book.theme else "null"|tojson }},
                                        {{ book.pages|tojson if book.pages else "null"|tojson }}, 
                                        {{ book.edition_number|tojson if book.edition_number else "null"|tojson }},
                                        {{ book.publication_year|tojson if book.publication_year else "null"|tojson }},
                                        {{ book.publisher|tojson if book.publisher else "null"|tojson }})' 
                                data-bs-toggle="tooltip" 
                                title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                            ‚úèÔ∏è
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteBook({{ book.id }})" data-bs-toggle="tooltip" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                        <button class="btn btn-sm btn-warning" onclick="managePurchases({{ book.id }})" data-bs-toggle="tooltip" title="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫—É–ø–∫–∞–º–∏">üì¶</button>
                        <a href="/books/{{ book.id }}/qrcodes" class="btn btn-sm btn-info" data-bs-toggle="tooltip" title="QR –∫–æ–¥—ã">üîç</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    {% if total_pages > 1 %}
    <nav aria-label="Page navigation" class="mt-4">
        <ul class="pagination justify-content-center">
            <li class="page-item {% if current_page == 1 %}disabled{% endif %}">
                <a class="page-link" href="?page=1&search={{ search_query }}" aria-label="First">
                    <span aria-hidden="true">¬´¬´</span>
                </a>
            </li>
            <li class="page-item {% if current_page == 1 %}disabled{% endif %}">
                <a class="page-link" href="?page={{ current_page - 1 }}&search={{ search_query }}" aria-label="Previous">
                    <span aria-hidden="true">¬´</span>
                </a>
            </li>
            
            {% for page in range(max(1, current_page - 2), min(total_pages + 1, current_page + 3)) %}
            <li class="page-item {% if page == current_page %}active{% endif %}">
                <a class="page-link" href="?page={{ page }}&search={{ search_query }}">{{ page }}</a>
            </li>
            {% endfor %}
            
            <li class="page-item {% if current_page == total_pages %}disabled{% endif %}">
                <a class="page-link" href="?page={{ current_page + 1 }}&search={{ search_query }}" aria-label="Next">
                    <span aria-hidden="true">¬ª</span>
                </a>
            </li>
            <li class="page-item {% if current_page == total_pages %}disabled{% endif %}">
                <a class="page-link" href="?page={{ total_pages }}&search={{ search_query }}" aria-label="Last">
                    <span aria-hidden="true">¬ª¬ª</span>
                </a>
            </li>
        </ul>
    </nav>
    {% endif %}
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–Ω–∏–≥–∏ -->
<div class="modal fade" id="bookModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="bookForm">
                <div class="modal-body">
                    <input type="hidden" id="bookId">
                    <input type="hidden" name="quantity" value="1">
                    <div class="mb-3">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏</label>
                        <input type="text" class="form-control" id="title" name="title" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ê–≤—Ç–æ—Ä</label>
                        <input type="text" class="form-control" id="author" name="author" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–¢–µ–º–∞—Ç–∏–∫–∞(–ñ–∞–Ω—Ä)</label>
                        <input type="text" class="form-control" name="theme" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea class="form-control" id="description" name="description" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü</label>
                        <input type="number" class="form-control" name="pages" required min="1">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ù–æ–º–µ—Ä –∏–∑–¥–∞–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)</label>
                        <input type="text" class="form-control" name="edition_number">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ì–æ–¥ –∏–∑–¥–∞–Ω–∏—è</label>
                        <input type="number" class="form-control" name="publication_year" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ò–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ</label>
                        <input type="text" class="form-control" name="publisher" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫—É–ø–∫–∞–º–∏ -->
<div class="modal fade" id="purchasesModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫—É–ø–∫–∞–º–∏</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addPurchaseForm" class="mb-4">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤</label>
                                <input type="number" class="form-control" id="quantity" name="quantity" required min="1">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä</label>
                                <input type="number" class="form-control" name="price" required min="0">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">–ü–æ—Å—Ç–∞–≤—â–∏–∫</label>
                                <input type="text" class="form-control" name="supplier" required>
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫—É–ø–∫—É</button>
                </form>

                <h6>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫—É–ø–æ–∫</h6>
                <div class="table-responsive">
                    <table class="table table-sm" id="purchasesHistory">
                        <thead>
                            <tr>
                                <th>–î–∞—Ç–∞</th>
                                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                <th>–¶–µ–Ω–∞/—à—Ç</th>
                                <th>–ü–æ—Å—Ç–∞–≤—â–∏–∫</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫—É–ø–æ–∫ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ —á–µ—Ä–µ–∑ JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
<div id="toast-container" class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
</div>

<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç—É–ª—Ç–∏–ø–æ–≤
document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    });

    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–∏—Å–∫–∞
    const searchInput = document.getElementById('searchInput');
    let searchTimeout;
    
    searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            const searchQuery = this.value.trim();
            window.location.href = `?page=1&search=${encodeURIComponent(searchQuery)}`;
        }, 500);
    });

    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É"
    const addBookBtn = document.querySelector('.btn-success');
    if (addBookBtn) {
        addBookBtn.addEventListener('click', function() {
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            document.getElementById('bookForm').reset();
            document.getElementById('bookId').value = '';
            document.getElementById('modalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É';
            
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            const modal = new bootstrap.Modal(document.getElementById('bookModal'));
            modal.show();
        });
    }
});

function editBook(id, title, author, description, theme, pages, edition_number, publication_year, publisher) {
    const modal = new bootstrap.Modal(document.getElementById('bookModal'));
    document.getElementById('modalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–∏–≥—É';
    document.getElementById('bookId').value = id;
    document.getElementById('title').value = title;
    document.getElementById('author').value = author;
    document.getElementById('description').value = description || '';
    document.querySelector('input[name="theme"]').value = theme || '';
    document.querySelector('input[name="pages"]').value = pages || '';
    document.querySelector('input[name="edition_number"]').value = edition_number || '';
    document.querySelector('input[name="publication_year"]').value = publication_year || '';
    document.querySelector('input[name="publisher"]').value = publisher || '';
    modal.show();
}

function deleteBook(id) {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–Ω–∏–≥—É?')) {
        fetch(`/books/${id}/delete`, {
            method: 'POST'
        }).then(response => {
            if (response.ok) {
                showToast('–ö–Ω–∏–≥–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞', 'success');
                setTimeout(() => location.reload(), 1500);
            } else {
                showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–Ω–∏–≥–∏', 'error');
            }
        });
    }
}

function managePurchases(bookId) {
    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
    document.getElementById('addPurchaseForm').reset();
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –∑–∞–∫—É–ø–æ–∫
    fetch(`/books/${bookId}/purchases`)
        .then(response => response.json())
        .then(data => {
            const tbody = document.querySelector('#purchasesHistory tbody');
            tbody.innerHTML = '';
            
            data.purchases.forEach(p => {
                tbody.innerHTML += `
                    <tr>
                        <td>${p.date}</td>
                        <td>${p.quantity}</td>
                        <td>${p.price} ‚ÇΩ</td>
                        <td>${p.supplier}</td>
                    </tr>
                `;
            });
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫—É–ø–∫–∏
            const form = document.getElementById('addPurchaseForm');
            form.onsubmit = (e) => {
                e.preventDefault();
                const formData = new FormData(form);
                
                fetch(`/books/${bookId}/purchases/add`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        quantity: parseInt(formData.get('quantity')),
                        price: parseInt(formData.get('price')),
                        supplier: formData.get('supplier')
                    })
                }).then(response => {
                    if (response.ok) {
                        showToast('–ó–∞–∫—É–ø–∫–∞ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞', 'success');
                        setTimeout(() => location.reload(), 1500);
                    } else {
                        showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∑–∞–∫—É–ø–∫–∏', 'error');
                    }
                });
            };
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            new bootstrap.Modal(document.getElementById('purchasesModal')).show();
        });
}

// –î–æ–±–∞–≤–∏–º —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–Ω–∏–≥–∞–º–∏
document.getElementById('bookForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    
    const bookId = document.getElementById('bookId').value;
    const url = bookId ? `/books/${bookId}/edit` : '/books/add';
    const method = bookId ? 'PUT' : 'POST';
    
    try {
        const response = await fetch(url, {
            method: method,
            body: formData
        });
        
        if (response.ok) {
            showToast(bookId ? '–ö–Ω–∏–≥–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞' : '–ö–Ω–∏–≥–∞ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞', 'success');
            setTimeout(() => window.location.reload(), 1500);
        } else {
            const data = await response.json();
            showToast(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–Ω–∏–≥–∏', 'error');
            alert(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–Ω–∏–≥–∏');
        }
    } catch (error) {
        console.error('Error:', error);
        showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–Ω–∏–≥–∏', 'error');
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–Ω–∏–≥–∏');
    }
});

function uploadExcel(input) {
    if (!input.files || !input.files[0]) return;
    
    const formData = new FormData();
    formData.append('file', input.files[0]);
    
    fetch('/admin/books/upload', {
        method: 'POST',
        body: formData
    }).then(response => {
        if (response.ok) {
            showToast('–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
            setTimeout(() => location.reload(), 1500);
        } else {
            showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞', 'error');
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞');
        }
    }).catch(error => {
        console.error('Error:', error);
        showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞', 'error');
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞');
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
function showToast(message, type = 'success') {
    const toastId = 'toast-' + Date.now();
    const bgClass = type === 'success' ? 'bg-success' : type === 'error' ? 'bg-danger' : 'bg-primary';
    
    const toastHTML = `
        <div id="${toastId}" class="toast show" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="3000">
            <div class="toast-header ${bgClass} text-white">
                <strong class="me-auto">${type === 'success' ? '–£—Å–ø–µ—à–Ω–æ' : type === 'error' ? '–û—à–∏–±–∫–∞' : '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ'}</strong>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                ${message}
            </div>
        </div>
    `;
    
    document.getElementById('toast-container').insertAdjacentHTML('beforeend', toastHTML);
    const toastElement = document.getElementById(toastId);
    
    // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è Toast
    try {
        const toast = new bootstrap.Toast(toastElement);
        toast.show();
    } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:', e);
        // –ï—Å–ª–∏ Bootstrap Toast –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –¥–æ–±–∞–≤–∏–º –∫–ª–∞—Å—Å show –≤—Ä—É—á–Ω—É—é
        toastElement.classList.add('show');
        
        // –ò —É–¥–∞–ª–∏–º –µ–≥–æ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            toastElement.remove();
        }, 3000);
    }
    
    // –£–¥–∞–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–∫—Ä—ã—Ç–∏—è
    toastElement.addEventListener('hidden.bs.toast', function () {
        toastElement.remove();
    });
}
</script>
{% endblock %} 